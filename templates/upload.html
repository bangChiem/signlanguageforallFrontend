<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Audio for Speech Recognition</title>
    <script>
        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    //const dictionary = {mimeType: 'audio/wav'}
                    const mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();

                    const audioChunks = [];
                    mediaRecorder.addEventListener("dataavailable", event => {
                        audioChunks.push(event.data);
                    });

                    mediaRecorder.addEventListener("stop", () => {
                        const audioBlob = new Blob(audioChunks);

                        const formData = new FormData();
                        formData.append("file", audioBlob);

                        fetch("/voice-recognition", {
                            method: "POST",
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            document.getElementById("transcription").textContent = data.recognized_text || "Error: " + data.error;
                        })
                        .catch(error => {
                            console.error(error);
                        });
                    });

                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, 5000); // Stop recording after 5 seconds
                });
        }
    </script>
</head>
<body>
    <h1>Record Audio for Speech Recognition</h1>
    <button onclick="startRecording()">Record Audio</button>
    <p id="transcription">Transcription will appear here after recording.</p>
</body>
</html>